<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Index</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">MySite</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="#">주제1</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">주제2</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">주제3</a>
                </li>
            </ul>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item" id="userNameWrapper" style="display:none;">
                    <a class="nav-link" href="#"><span id="userRole"></span> <span id="userName"></span> 님</a>
                </li>
                <li class="nav-item" id="linkLogin">
                    <a class="nav-link" href="login.html">로그인</a>
                </li>
                <li class="nav-item" id="linkSignup">
                    <a class="nav-link" href="register.html">회원가입</a>
                </li>
                <li class="nav-item" id="linkLogout" style="display:none;">
                    <a class="nav-link" href="#">로그아웃</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="container mt-5">
    <h1>Welcome to the Index Page!</h1>
</div>

<script>
    window.onload = function() {
        initUI();

        document.querySelector("#linkLogout").onclick = async function() {
            let response = await fetch("/api/employees/logout");
            let data = await response.json();
            console.log(data);

            if (data.result === "success") {
                sessionStorage.removeItem("name");
                sessionStorage.removeItem("email");
                sessionStorage.removeItem("roles");
                initUI();
            }
        }
    }

    function initUI() {
        let name = sessionStorage.getItem("name");
        let rolesJson = sessionStorage.getItem("roles"); // roles 배열 가져옴

        if (name != null && rolesJson != null) {
            let roles = JSON.parse(rolesJson); // JSON 문자열 -> 배열로 변환

            // 역할 우선순위 설정
            const rolePriority = { "점장": 1, "매니저": 2, "스태프": 3 };

            // 가장 높은 권한 선택
            roles.sort((a, b) => (rolePriority[a] || 999) - (rolePriority[b] || 999));
            let highestRole = roles[0];

            document.querySelector("#userRole").innerText = highestRole;
            document.querySelector("#userName").innerText = name;
            document.querySelector("#userNameWrapper").style.display = 'block';
            document.querySelector("#linkLogout").style.display = 'block';
            document.querySelector("#linkLogin").style.display = 'none';
            document.querySelector("#linkSignup").style.display = 'none';
        } else {
            document.querySelector("#userRole").innerText = '';
            document.querySelector("#userName").innerText = '';
            document.querySelector("#userNameWrapper").style.display = 'none';
            document.querySelector("#linkLogout").style.display = 'none';
            document.querySelector("#linkLogin").style.display = 'block';
            document.querySelector("#linkSignup").style.display = 'block';
        }
    }
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>